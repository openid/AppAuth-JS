"use strict";
/*
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the
 * License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
var query_string_utils_1 = require("./query_string_utils");
var MOCK_LOCATION_UNDEFINED = 'undefined';
/**
 * Useful in the context of writing tests.
 */
var MockLocationLike = /** @class */ (function () {
    function MockLocationLike() {
        this.hash = MOCK_LOCATION_UNDEFINED;
        this.host = MOCK_LOCATION_UNDEFINED;
        this.origin = MOCK_LOCATION_UNDEFINED;
        this.hostname = MOCK_LOCATION_UNDEFINED;
        this.pathname = MOCK_LOCATION_UNDEFINED;
        this.port = MOCK_LOCATION_UNDEFINED;
        this.protocol = MOCK_LOCATION_UNDEFINED;
        this.search = MOCK_LOCATION_UNDEFINED;
        this.assign = function () { };
    }
    MockLocationLike.prototype.setHash = function (hash) {
        this.hash = hash;
        return this;
    };
    MockLocationLike.prototype.setHost = function (host) {
        this.host = host;
        return this;
    };
    MockLocationLike.prototype.setOrigin = function (origin) {
        this.origin = origin;
        return this;
    };
    MockLocationLike.prototype.setHostname = function (hostname) {
        this.hostname = hostname;
        return this;
    };
    MockLocationLike.prototype.setPathname = function (pathname) {
        this.pathname = pathname;
        return this;
    };
    MockLocationLike.prototype.setPort = function (port) {
        this.port = port;
        return this;
    };
    MockLocationLike.prototype.setProtocol = function (protocol) {
        this.protocol = protocol;
        return this;
    };
    MockLocationLike.prototype.setSearch = function (search) {
        this.search = search;
        return this;
    };
    MockLocationLike.prototype.setAssign = function (assign) {
        this.assign = assign;
        return this;
    };
    return MockLocationLike;
}());
describe('Query String Parser Tests', function () {
    var locationLike = new MockLocationLike();
    var parser = new query_string_utils_1.BasicQueryStringUtils();
    it('Empty query string should not blow up.', function () {
        locationLike.setSearch('?');
        var result = parser.parse(locationLike);
        var keys = Object.keys(result);
        expect(result).toBeTruthy();
        expect(keys.length).toBe(0, 'No query parameters provided');
    });
    it('Should parse simple query strings.', function () {
        locationLike.setSearch(encodeURI('key1=value1&key2=value 2& key3= value 3'));
        var result = parser.parse(locationLike);
        var keys = Object.keys(result);
        expect(result).toBeTruthy();
        expect(keys.length).toBe(3, '3 Query parameters should be present');
        expect(keys[0]).toBe('key1');
        expect(keys[1]).toBe('key2');
        expect(keys[2]).toBe(' key3');
        expect(result[keys[0]]).toBe('value1', 'Expected value is "value1"');
        expect(result[keys[1]]).toBe('value 2', 'Expected value is "value 2"');
        expect(result[keys[2]]).toBe(' value 3', 'Expected value is " value 3"');
    });
    it('Should handle params with no values', function () {
        locationLike.setSearch(encodeURI('key1=value1&key2='));
        var result = parser.parse(locationLike);
        var keys = Object.keys(result);
        expect(result).toBeTruthy();
        expect(keys.length).toBe(1, '1 Query parameter should be present');
        expect(keys[0]).toBe('key1');
        expect(result[keys[0]]).toBe('value1', 'Expected value is "value1"');
    });
    it('Should handle duplicate parameter values', function () {
        locationLike.setSearch(encodeURI('key1=value1&key1=value2'));
        var result = parser.parse(locationLike);
        var keys = Object.keys(result);
        expect(result).toBeTruthy();
        expect(keys.length).toBe(1, '1 Query parameter should be present');
        expect(keys[0]).toBe('key1');
        expect(result[keys[0]]).toBe('value2', 'Expected value is "value2"');
    });
    it('Should be able to deal with escaped # or ? characters', function () {
        locationLike.setSearch(encodeURI('key1=value1?&key2=value2 #'));
        var result = parser.parse(locationLike);
        var keys = Object.keys(result);
        expect(result).toBeTruthy();
        expect(keys.length).toBe(2, '2 Query parameters should be present');
        expect(keys[0]).toBe('key1');
        expect(keys[1]).toBe('key2');
        expect(result[keys[0]]).toBe('value1?', 'Expected value is "value1?"');
        expect(result[keys[1]]).toBe('value2 #', 'Expected value is "value2 #"');
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlcnlfc3RyaW5nX3V0aWxzX3Rlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvcXVlcnlfc3RyaW5nX3V0aWxzX3Rlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7R0FZRzs7QUFFSCwyREFBMkQ7QUFHM0QsSUFBTSx1QkFBdUIsR0FBRyxXQUFXLENBQUM7QUFFNUM7O0dBRUc7QUFDSDtJQVdFO1FBQ0UsSUFBSSxDQUFDLElBQUksR0FBRyx1QkFBdUIsQ0FBQztRQUNwQyxJQUFJLENBQUMsSUFBSSxHQUFHLHVCQUF1QixDQUFDO1FBQ3BDLElBQUksQ0FBQyxNQUFNLEdBQUcsdUJBQXVCLENBQUM7UUFDdEMsSUFBSSxDQUFDLFFBQVEsR0FBRyx1QkFBdUIsQ0FBQztRQUN4QyxJQUFJLENBQUMsUUFBUSxHQUFHLHVCQUF1QixDQUFDO1FBQ3hDLElBQUksQ0FBQyxJQUFJLEdBQUcsdUJBQXVCLENBQUM7UUFDcEMsSUFBSSxDQUFDLFFBQVEsR0FBRyx1QkFBdUIsQ0FBQztRQUN4QyxJQUFJLENBQUMsTUFBTSxHQUFHLHVCQUF1QixDQUFDO1FBQ3RDLElBQUksQ0FBQyxNQUFNLEdBQUcsY0FBTyxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUVELGtDQUFPLEdBQVAsVUFBUSxJQUFZO1FBQ2xCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELGtDQUFPLEdBQVAsVUFBUSxJQUFZO1FBQ2xCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELG9DQUFTLEdBQVQsVUFBVSxNQUFjO1FBQ3RCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELHNDQUFXLEdBQVgsVUFBWSxRQUFnQjtRQUMxQixJQUFJLENB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Z2h0IDIwMTcgR29vZ2xlIEluYy5cclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHRcclxuICogaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlXHJcbiAqIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyXHJcbiAqIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcblxyXG5pbXBvcnQge0Jhc2ljUXVlcnlTdHJpbmdVdGlsc30gZnJvbSAnLi9xdWVyeV9zdHJpbmdfdXRpbHMnO1xyXG5pbXBvcnQge0xvY2F0aW9uTGlrZSwgU3RyaW5nTWFwfSBmcm9tICcuL3R5cGVzJztcclxuXHJcbmNvbnN0IE1PQ0tfTE9DQVRJT05fVU5ERUZJTkVEID0gJ3VuZGVmaW5lZCc7XHJcblxyXG4vKipcclxuICogVXNlZnVsIGluIHRoZSBjb250ZXh0IG9mIHdyaXRpbmcgdGVzdHMuXHJcbiAqL1xyXG5jbGFzcyBNb2NrTG9jYXRpb25MaWtlIGltcGxlbWVudHMgTG9jYXRpb25MaWtlIHtcclxuICBwdWJsaWMgaGFzaDogc3RyaW5nO1xyXG4gIHB1YmxpYyBob3N0OiBzdHJpbmc7XHJcbiAgcHVibGljIG9yaWdpbjogc3RyaW5nO1xyXG4gIHB1YmxpYyBob3N0bmFtZTogc3RyaW5nO1xyXG4gIHB1YmxpYyBwYXRobmFtZTogc3RyaW5nO1xyXG4gIHB1YmxpYyBwb3J0OiBzdHJpbmc7XHJcbiAgcHVibGljIHByb3RvY29sOiBzdHJpbmc7XHJcbiAgcHVibGljIHNlYXJjaDogc3RyaW5nO1xyXG4gIHB1YmxpYyBhc3NpZ246ICh1cmw6IHN0cmluZykgPT4gdm9pZDtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmhhc2ggPSBNT0NLX0xPQ0FUSU9OX1VOREVGSU5FRDtcclxuICAgIHRoaXMuaG9zdCA9IE1PQ0tfTE9DQVRJT05fVU5ERUZJTkVEO1xyXG4gICAgdGhpcy5vcmlnaW4gPSBNT0NLX0xPQ0FUSU9OX1VOREVGSU5FRDtcclxuICAgIHRoaXMuaG9zdG5hbWUgPSBNT0NLX0xPQ0FUSU9OX1VOREVGSU5FRDtcclxuICAgIHRoaXMucGF0aG5hbWUgPSBNT0NLX0xPQ0FUSU9OX1VOREVGSU5FRDtcclxuICAgIHRoaXMucG9ydCA9IE1PQ0tfTE9DQVRJT05fVU5ERUZJTkVEO1xyXG4gICAgdGhpcy5wcm90b2NvbCA9IE1PQ0tfTE9DQVRJT05fVU5ERUZJTkVEO1xyXG4gICAgdGhpcy5zZWFyY2ggPSBNT0NLX0xPQ0FUSU9OX1VOREVGSU5FRDtcclxuICAgIHRoaXMuYXNzaWduID0gKCkgPT4ge307XHJcbiAgfVxyXG5cclxuICBzZXRIYXNoKGhhc2g6IHN0cmluZyk6IE1vY2tMb2NhdGlvbkxpa2Uge1xyXG4gICAgdGhpcy5oYXNoID0gaGFzaDtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgc2V0SG9zdChob3N0OiBzdHJpbmcpOiBNb2NrTG9jYXRpb25MaWtlIHtcclxuICAgIHRoaXMuaG9zdCA9IGhvc3Q7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIHNldE9yaWdpbihvcmlnaW46IHN0cmluZyk6IE1vY2tMb2NhdGlvbkxpa2Uge1xyXG4gICAgdGhpcy5vcmlnaW4gPSBvcmlnaW47XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIHNldEhvc3RuYW1lKGhvc3RuYW1lOiBzdHJpbmcpOiBNb2NrTG9jYXRpb25MaWtlIHtcclxuICAgIHRoaXMuaG9zdG5hbWUgPSBob3N0bmFtZTtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgc2V0UGF0aG5hbWUocGF0aG5hbWU6IHN0cmluZyk6IE1vY2tMb2NhdGlvbkxpa2Uge1xyXG4gICAgdGhpcy5wYXRobmFtZSA9IHBhdGhuYW1lO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICBzZXRQb3J0KHBvcnQ6IHN0cmluZyk6IE1vY2tMb2NhdGlvbkxpa2Uge1xyXG4gICAgdGhpcy5wb3J0ID0gcG9ydDtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgc2V0UHJvdG9jb2wocHJvdG9jb2w6IHN0cmluZyk6IE1vY2tMb2NhdGlvbkxpa2Uge1xyXG4gICAgdGhpcy5wcm90b2NvbCA9IHByb3RvY29sO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICBzZXRTZWFyY2goc2VhcmNoOiBzdHJpbmcpOiBNb2NrTG9jYXRpb25MaWtlIHtcclxuICAgIHRoaXMuc2VhcmNoID0gc2VhcmNoO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICBzZXRBc3NpZ24oYXNzaWduOiAoKSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLmFzc2lnbiA9IGFzc2lnbjtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxufVxyXG5cclxuZGVzY3JpYmUoJ1F1ZXJ5IFN0cmluZyBQYXJzZXIgVGVzdHMnLCAoKSA9PiB7XHJcbiAgY29uc3QgbG9jYXRpb25MaWtlID0gbmV3IE1vY2tMb2NhdGlvbkxpa2UoKTtcclxuICBjb25zdCBwYXJzZXIgPSBuZXcgQmFzaWNRdWVyeVN0cmluZ1V0aWxzKCk7XHJcblxyXG4gIGl0KCdFbXB0eSBxdWVyeSBzdHJpbmcgc2hvdWxkIG5vdCBibG93IHVwLicsICgpID0+IHtcclxuICAgIGxvY2F0aW9uTGlrZS5zZXRTZWFyY2goJz8nKTtcclxuICAgIGxldCByZXN1bHQgPSBwYXJzZXIucGFyc2UobG9jYXRpb25MaWtlKTtcclxuICAgIGxldCBrZXlzID0gT2JqZWN0LmtleXMocmVzdWx0KTtcclxuICAgIGV4cGVjdChyZXN1bHQpLnRvQmVUcnV0aHkoKTtcclxuICAgIGV4cGVjdChrZXlzLmxlbmd0aCkudG9CZSgwLCAnTm8gcXVlcnkgcGFyYW1ldGVycyBwcm92aWRlZCcpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnU2hvdWxkIHBhcnNlIHNpbXBsZSBxdWVyeSBzdHJpbmdzLicsICgpID0+IHtcclxuICAgIGxvY2F0aW9uTGlrZS5zZXRTZWFyY2goZW5jb2RlVVJJKCdrZXkxPXZhbHVlMSZrZXkyPXZhbHVlIDImIGtleTM9IHZhbHVlIDMnKSk7XHJcbiAgICBsZXQgcmVzdWx0ID0gcGFyc2VyLnBhcnNlKGxvY2F0aW9uTGlrZSk7XHJcbiAgICBsZXQga2V5cyA9IE9iamVjdC5rZXlzKHJlc3VsdCk7XHJcbiAgICBleHBlY3QocmVzdWx0KS50b0JlVHJ1dGh5KCk7XHJcbiAgICBleHBlY3Qoa2V5cy5sZW5ndGgpLnRvQmUoMywgJzMgUXVlcnkgcGFyYW1ldGVycyBzaG91bGQgYmUgcHJlc2VudCcpO1xyXG4gICAgZXhwZWN0KGtleXNbMF0pLnRvQmUoJ2tleTEnKTtcclxuICAgIGV4cGVjdChrZXlzWzFdKS50b0JlKCdrZXkyJyk7XHJcbiAgICBleHBlY3Qoa2V5c1syXSkudG9CZSgnIGtleTMnKTtcclxuICAgIGV4cGVjdChyZXN1bHRba2V5c1swXV0pLnRvQmUoJ3ZhbHVlMScsICdFeHBlY3RlZCB2YWx1ZSBpcyBcInZhbHVlMVwiJyk7XHJcbiAgICBleHBlY3QocmVzdWx0W2tleXNbMV1dKS50b0JlKCd2YWx1ZSAyJywgJ0V4cGVjdGVkIHZhbHVlIGlzIFwidmFsdWUgMlwiJyk7XHJcbiAgICBleHBlY3QocmVzdWx0W2tleXNbMl1dKS50b0JlKCcgdmFsdWUgMycsICdFeHBlY3RlZCB2YWx1ZSBpcyBcIiB2YWx1ZSAzXCInKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ1Nob3VsZCBoYW5kbGUgcGFyYW1zIHdpdGggbm8gdmFsdWVzJywgKCkgPT4ge1xyXG4gICAgbG9jYXRpb25MaWtlLnNldFNlYXJjaChlbmNvZGVVUkkoJ2tleTE9dmFsdWUxJmtleTI9JykpO1xyXG4gICAgbGV0IHJlc3VsdCA9IHBhcnNlci5wYXJzZShsb2NhdGlvbkxpa2UpO1xyXG4gICAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyhyZXN1bHQpO1xyXG4gICAgZXhwZWN0KHJlc3VsdCkudG9CZVRydXRoeSgpO1xyXG4gICAgZXhwZWN0KGtleXMubGVuZ3RoKS50b0JlKDEsICcxIFF1ZXJ5IHBhcmFtZXRlciBzaG91bGQgYmUgcHJlc2VudCcpO1xyXG4gICAgZXhwZWN0KGtleXNbMF0pLnRvQmUoJ2tleTEnKTtcclxuICAgIGV4cGVjdChyZXN1bHRba2V5c1swXV0pLnRvQmUoJ3ZhbHVlMScsICdFeHBlY3RlZCB2YWx1ZSBpcyBcInZhbHVlMVwiJyk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdTaG91bGQgaGFuZGxlIGR1cGxpY2F0ZSBwYXJhbWV0ZXIgdmFsdWVzJywgKCkgPT4ge1xyXG4gICAgbG9jYXRpb25MaWtlLnNldFNlYXJjaChlbmNvZGVVUkkoJ2tleTE9dmFsdWUxJmtleTE9dmFsdWUyJykpO1xyXG4gICAgbGV0IHJlc3VsdCA9IHBhcnNlci5wYXJzZShsb2NhdGlvbkxpa2UpO1xyXG4gICAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyhyZXN1bHQpO1xyXG4gICAgZXhwZWN0KHJlc3VsdCkudG9CZVRydXRoeSgpO1xyXG4gICAgZXhwZWN0KGtleXMubGVuZ3RoKS50b0JlKDEsICcxIFF1ZXJ5IHBhcmFtZXRlciBzaG91bGQgYmUgcHJlc2VudCcpO1xyXG4gICAgZXhwZWN0KGtleXNbMF0pLnRvQmUoJ2tleTEnKTtcclxuICAgIGV4cGVjdChyZXN1bHRba2V5c1swXV0pLnRvQmUoJ3ZhbHVlMicsICdFeHBlY3RlZCB2YWx1ZSBpcyBcInZhbHVlMlwiJyk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdTaG91bGQgYmUgYWJsZSB0byBkZWFsIHdpdGggZXNjYXBlZCAjIG9yID8gY2hhcmFjdGVycycsICgpID0+IHtcclxuICAgIGxvY2F0aW9uTGlrZS5zZXRTZWFyY2goZW5jb2RlVVJJKCdrZXkxPXZhbHVlMT8ma2V5Mj12YWx1ZTIgIycpKTtcclxuICAgIGxldCByZXN1bHQgPSBwYXJzZXIucGFyc2UobG9jYXRpb25MaWtlKTtcclxuICAgIGxldCBrZXlzID0gT2JqZWN0LmtleXMocmVzdWx0KTtcclxuICAgIGV4cGVjdChyZXN1bHQpLnRvQmVUcnV0aHkoKTtcclxuICAgIGV4cGVjdChrZXlzLmxlbmd0aCkudG9CZSgyLCAnMiBRdWVyeSBwYXJhbWV0ZXJzIHNob3VsZCBiZSBwcmVzZW50Jyk7XHJcbiAgICBleHBlY3Qoa2V5c1swXSkudG9CZSgna2V5MScpO1xyXG4gICAgZXhwZWN0KGtleXNbMV0pLnRvQmUoJ2tleTInKTtcclxuICAgIGV4cGVjdChyZXN1bHRba2V5c1swXV0pLnRvQmUoJ3ZhbHVlMT8nLCAnRXhwZWN0ZWQgdmFsdWUgaXMgXCJ2YWx1ZTE/XCInKTtcclxuICAgIGV4cGVjdChyZXN1bHRba2V5c1sxXV0pLnRvQmUoJ3ZhbHVlMiAjJywgJ0V4cGVjdGVkIHZhbHVlIGlzIFwidmFsdWUyICNcIicpO1xyXG4gIH0pO1xyXG59KTtcclxuIl19